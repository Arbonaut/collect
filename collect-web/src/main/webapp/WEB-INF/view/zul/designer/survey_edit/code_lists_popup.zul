<zk>
	<window id="codeListsManagerPopUp" title="${labels.survey.code_list.manager.title}" 
		width="800px" 
		height="500px"
		border="normal"
		position="center" 
		closable="false">
		<borderlayout id="codeListsManagerContainer"
				apply="org.zkoss.bind.BindComposer"
				viewModel="@id('vm') @init('org.openforis.collect.designer.viewmodel.SurveyCodeListsEditVM')"
				validationMessages="@id('vmsgs')">
			<west width="220px">
				<borderlayout>
					<center border="none">
					    <listbox id="itemsListBox"
					        	selectedItem="@bind(vm.selectedItem)"
					        	model="@load(vm.items)"
					        	onSelect="@command('selectionChanged', selectedItem=self.selectedItem.value)"
					        	width="220px"
				        		vflex="true">
				        	<listhead>
								<listheader label="" width="150px" />
								<listheader label="" width="50px" />
							</listhead>
				            <template name="model">
				                <listitem>
				                    <listcell label="@load(each.name)" />
				                    <listcell>
				                    	<button image="/assets/images/cross-small.png"
				                     		onClick="@command('deleteItem', item=each)" />
				                    </listcell>
				                </listitem>
				            </template>
				        </listbox>
		        	</center>
					<south border="none">
				        <toolbar>
				        	<toolbarbutton label="${labels.global.add_item}" 
				        			onClick="@command('newItem') @global-command('codeListsUpdated')" />
				        	<toolbarbutton image="/assets/images/arrow-up.png"
									disabled="@load(vm.moveSelectedItemUpDisabled)" 
						        	onClick="@command('moveSelectedItemUp')" />
				        	<toolbarbutton image="/assets/images/arrow-down.png"
									disabled="@load(vm.moveSelectedItemDownDisabled)" 
						        	onClick="@command('moveSelectedItemDown')" />
				        </toolbar>
					</south>
			    </borderlayout>
	    	</west>
		   	<center>
		        <div 
		        	visible="@load(vm.editingItem)"
					validationMessages="@id('vmsgs')"
					form="@id('fx') 
						@load(vm.formObject) @save(vm.formObject, before='applyChanges')
						@validator('org.openforis.collect.designer.form.validator.CodeListFormValidator')"
					width="100%">
					<grid>
						<columns>
							<column label="" width="150px" />
							<column label="" width="100%" />
						</columns>
						<rows>
							<row>
								<label value="${labels.global.item.name}:" />
								<cell>
									<textbox width="150px" value="@bind(fx.name)" onChange="@command('applyChanges')" />
									<label class="error" value="@load(vmsgs['name'])" />
								</cell>
							</row>
							<row>
								<label value="${labels.survey.code_list.item_label}:" />
								<cell>
									<textbox width="150px" value="@bind(fx.itemLabel)" onChange="@command('applyChanges')" />
									<label class="error" value="@load(vmsgs['itemLabel'])" />
								</cell>
							</row>
							<row>
								<label value="${labels.survey.code_list.list_label}:" />
								<cell>
									<textbox width="150px" value="@bind(fx.listLabel)" onChange="@command('applyChanges')" />
									<label class="error" value="@load(vmsgs['listLabel'])" />
								</cell>
							</row>
							<row>
								<label value="${labels.global.item.since_version}:" />
								<cell>
									<listbox width="150px"
					                    model="@load(vm.versionsForCombo)" 
					                    selectedItem="@bind(fx.sinceVersion)"
					                    onSelect="@command('applyChanges')"
					                    mold="select">
					                    <template name="model">
					                        <listitem label="@load(each.name)" />
					                    </template>
					                </listbox>
				                	<label class="error" value="@load(vmsgs['sinceVersion'])" />
								</cell>
				            </row>
				            <row>
								<label value="${labels.global.item.deprecated_version}:" />
								<cell>
									<listbox width="150px"
					                    model="@load(vm.versionsForCombo)" 
					                    selectedItem="@bind(fx.deprecatedVersion)"
					                    onSelect="@command('applyChanges')"
					                    mold="select">
					                    <template name="model">
					                        <listitem label="@load(each.name)" />
					                    </template>
					                </listbox>
					                <label class="error" value="@load(vmsgs['deprecatedVersion'])" />
								</cell>
				            </row>
				            <row>
				            	<label value="${labels.survey.code_list.type.$}:" />
								<radiogroup selectedItem="@bind(fx.type)" onCheck="@command('typeChanged', type=self.selectedItem.value)">
									<radio label="${labels.survey.code_list.type.hierarchical}"
										value="HIERARCHICAL" disabled="@load(vm.multipleLevelsPresent)" />
									<radio label="${labels.survey.code_list.type.flat}"
										value="FLAT" disabled="@load(vm.multipleLevelsPresent)" />
								</radiogroup>
				            </row>
						</rows>
					</grid>
					
					<hlayout>
						<hlayout children="@load(vm.listLevels)">
							<template name="children">
								<groupbox closable="false" contentStyle="padding: 0px"
									mold="@load(fx.type eq 'HIERARCHICAL' ? '3d': '')"
									width="120px">
									<caption visible="@load(fx.type eq 'HIERARCHICAL' ? true: false)">
										<textbox inplace="true" width="100%" value="@bind(each.name)" />
									</caption>
									<listbox model="@load(vm.itemsPerLevel[forEachStatus.index])"
										height="150px" 
										selectedItem="@load(vm.lastSelectedLevelIndex ge forEachStatus.index ? 
											vm.selectedItemsPerLevel[forEachStatus.index]: null)"
										onSelect="@command('listItemSelected', item=self.selectedItem.value, levelIndex=forEachStatus.index)">
										<listhead>
											<listheader width="80px" label="" />
											<listheader width="20px" label="" />
										</listhead>
										<template name="model">
											<listitem>
												<listcell onDoubleClick="@command('codeListItemDoubleClicked', item=each)">
													<label value="@load(each.code)" />
												</listcell>
												<listcell style="padding: 0px">
													<image src="@load(each.hasChildItems() ? 
														(self.parent.listbox.selectedItem eq self.parent.parent ? 
														'/assets/images/arrow-right-selected-small.png': 
														'/assets/images/arrow-right-small.png'): '')" />
												</listcell>
											</listitem>
										</template>
									</listbox>
									<button label="${labels.survey.code_list.add_child_item}" 
										disabled="@load(forEachStatus.index gt vm.lastSelectedLevelIndex + 1)"
					 					onClick="@command('addItemInLevel', levelIndex=forEachStatus.index)" />
								</groupbox>
							</template>
						</hlayout>
						<vlayout id="levelsControlBar" visible="@load(fx.type eq 'HIERARCHICAL')">
						 	<button label="${labels.survey.code_list.add_level}" 
						 		onClick="@command('addLevel')" />
						 	<button label="${labels.survey.code_list.remove_level}" 
						 		onClick="@command('removeLevel')"
						 		visible="@load(vm.multipleLevelsPresent)" />
						</vlayout>
					</hlayout>
				</div>
			</center>
			<south>
				<box align="center" width="100%">
					<button label="${labels.global.close}" 
						onClick="@global-command('closeCodeListsManagerPopUp')" />
				</box>
			</south>
		</borderlayout>
	</window>
</zk>