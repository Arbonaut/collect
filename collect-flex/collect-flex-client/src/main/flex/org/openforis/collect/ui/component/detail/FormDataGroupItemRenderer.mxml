<?xml version="1.0" encoding="utf-8"?>
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" 
				xmlns:s="library://ns.adobe.com/flex/spark" 
				xmlns:mx="library://ns.adobe.com/flex/mx"
				dataChange="dataChangeHandler(event)" 
				autoDrawBackground="false"
				>
	
	<fx:Script>
		<![CDATA[
			import mx.binding.utils.BindingUtils;
			import mx.events.FlexEvent;
			
			import org.openforis.collect.metamodel.proxy.AttributeDefinitionProxy;
			import org.openforis.collect.metamodel.proxy.EntityDefinitionProxy;
			import org.openforis.collect.ui.UIBuilder;
			
			import spark.components.HGroup;
			import spark.components.Label;
			
			override protected function createChildren():void {
				super.createChildren();
				if(data != null) {
					if(data is AttributeDefinitionProxy) {
						var hGroup:HGroup = new HGroup();
						var label:Label = new Label();
						label.width = 150;
						label.text = data.getLabelText();
						hGroup.addElement(label);
						var attrFormItem:AttributeFormItem = UIBuilder.getAttributeFormItem(AttributeDefinitionProxy(data));
						hGroup.addElement(attrFormItem);
						addElement(hGroup);
						//bind parentEntity of each attrFormItem to the "entity" of the form 
						BindingUtils.bindProperty(attrFormItem, "parentEntity", parentDocument, "entity");
					} else if(data is EntityDefinitionProxy) {
						var entityFormItem:EntityFormItem = UIBuilder.getEntityFormItem(EntityDefinitionProxy(data));
						addElement(entityFormItem);
						
						BindingUtils.bindProperty(entityFormItem, "parentEntity", parentDocument, "entity");
					}
				}
			}
			
			protected function dataChangeHandler(event:FlexEvent):void {
				removeAllElements();
				initialized = false;
				initialize();
			}
			
			
		]]>
	</fx:Script>
</s:ItemRenderer>
